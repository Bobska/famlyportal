{% load family_tags %}
{% load app_status %}

<div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-4">
    {% app_status app_name as status %}
    {% app_config app_name as config %}
    
    {% if status == 'coming_soon' %}
        <!-- Coming Soon Card - Not Clickable -->
        <div class="app-card app-card-coming-soon h-100">
            <div class="app-card-body text-center">
                <div class="app-icon-container mb-3">
                    <i class="{{ icon }} app-icon text-warning"></i>
                    <div class="coming-soon-badge">
                        <i class="bi bi-clock"></i> Soon
                    </div>
                </div>
                <h4 class="app-title text-dark">{{ app_title }}</h4>
                <p class="app-description text-muted">{{ app_description|truncate_smart:85 }}</p>
                <div class="app-status-indicator">
                    <small class="text-warning fw-semibold">
                        <i class="bi bi-tools"></i> In Development
                        {% if config.eta %}
                            <br>Expected: {{ config.eta }}
                        {% endif %}
                    </small>
                </div>
            </div>
        </div>
    {% elif has_permission %}
        <!-- Clickable App Card -->
        <a href="{% url dashboard_url %}" class="app-card-link text-decoration-none">
            <div class="app-card app-card-active h-100">
                <div class="app-card-body text-center">
                    <div class="app-icon-container mb-3">
                        <i class="{{ icon }} app-icon text-primary"></i>
                        <div class="app-access-indicator">
                            <i class="bi bi-arrow-right-circle"></i>
                        </div>
                    </div>
                    <h4 class="app-title text-dark">{{ app_title }}</h4>
                    <p class="app-description text-muted">{{ app_description|truncate_smart:85 }}</p>
                    <div class="app-status-indicator">
                        <small class="text-success fw-semibold">
                            <i class="bi bi-check-circle"></i> Ready to Use
                        </small>
                    </div>
                </div>
            </div>
        </a>
    {% else %}
        <!-- Restricted Access Card - Not Clickable -->
        <div class="app-card app-card-restricted h-100">
            <div class="app-card-body text-center">
                <div class="app-icon-container mb-3">
                    <i class="{{ icon }} app-icon text-muted"></i>
                    <div class="restricted-badge">
                        <i class="bi bi-lock"></i>
                    </div>
                </div>
                <h4 class="app-title text-muted">{{ app_title }}</h4>
                <p class="app-description text-muted">{{ app_description|truncate_smart:85 }}</p>
                <div class="app-status-indicator">
                    <small class="text-muted">
                        <i class="bi bi-shield-x"></i> Access Restricted
                    </small>
                </div>
            </div>
        </div>
    {% endif %}
</div>
