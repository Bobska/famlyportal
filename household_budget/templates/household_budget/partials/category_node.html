{% load static %}

<div class="category-node" data-category-id="{{ category.id }}">
    <div class="category-item">
        <div class="d-flex align-items-center">
            {% if category.children.exists %}
                <button class="category-toggle btn btn-sm btn-link p-0 me-2">
                    <i class="bi bi-chevron-right"></i>
                </button>
            {% else %}
                <span class="category-spacer me-3"></span>
            {% endif %}
            
            <div class="category-icon me-2">
                <i class="{{ category.icon|default:'bi bi-tag' }}"></i>
            </div>
            
            <div class="flex-grow-1">
                <div class="category-name">{{ category.name }}</div>
                {% if category.description %}
                    <small class="text-muted">{{ category.description }}</small>
                {% endif %}
            </div>
            
            <div class="category-stats me-3">
                <small class="text-muted">
                    {% if category.transaction_count %}
                        {{ category.transaction_count }} transaction{{ category.transaction_count|pluralize }}
                    {% else %}
                        No transactions
                    {% endif %}
                </small>
            </div>
            
            <div class="category-actions">
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item category-edit-btn" href="#" 
                               data-category-id="{{ category.id }}">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'household_budget:category_add' %}?parent={{ category.id }}">
                                <i class="bi bi-plus"></i> Add Subcategory
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger category-delete-btn" href="#"
                               data-category-id="{{ category.id }}"
                               data-category-name="{{ category.name }}"
                               data-transaction-count="{{ category.transaction_count|default:0 }}"
                               data-subcategory-count="{{ category.children.count }}">
                                <i class="bi bi-trash"></i> Delete
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    {% if category.children.exists %}
        <div class="category-children" style="display: none;">
            {% for child in category.children.all %}
                {% include 'household_budget/partials/category_node.html' with category=child %}
            {% endfor %}
        </div>
    {% endif %}
</div>
